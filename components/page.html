<div class="strib strib-styles strib-styles-specifically">
  <div class="container-lg">
    {{#if camps}}
      <div class="filters cf">
        <h2>Filters</h2>

        <div class="filters-column">
          <InputSlider bind:value="filterPrice"
            min="{{ minPrice }}" max="{{ maxPrice }}"
            bind:minValue="filterPriceMin" bind:maxValue="filterPriceMax" />
        </div>
      </div>

      <div class="camps">
        <h2>Camps</h2>

        {{#each filteredCamps as c @id}}
          <Camp camp="{{ c }}" />
        {{/each}}
      </div>
    {{/if}}
  </div>
</div>

<script>
import Camp from './camp.html';
import InputSlider from './input-slider.html';
import { setDeep } from 'svelte-extras';

export default {
  components: {
    Camp,
    InputSlider
  },

  methods: {
    setDeep
  },

  computed: {
    filteredCamps: (camps, filters) => {
      let filtered = camps;

      if (camps && camps.length && filters) {
        // Type
        if (filters.type) {
          filtered = filtered.filter(c => {
            return _.find(c.types, t => t.type === filters.type);
          });
        }
      }

      return filtered;
    },

    minPrice: camps => {
      return camps
        ? camps.map(c => c.minPrice).reduce((memo, p) => {
            return Math.min(memo || 999999, p);
          })
        : 0;
    },

    maxPrice: camps => {
      return camps
        ? camps.map(c => c.maxPrice).reduce((memo, p) => {
            return Math.max(memo || 0, p);
          })
        : 1000;
    }
  },

  data: () => {
    return {
      filters: {}
    };
  }
};
</script>
